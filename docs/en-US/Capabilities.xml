<?xml version='1.0' encoding='utf-8' ?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN" "http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd" [
<!ENTITY % BOOK_ENTITIES SYSTEM "REST_API_Guide.ent">
%BOOK_ENTITIES;
]>
<chapter id="chap-REST_API_Guide-Capabilities">
  <title>Capabilities</title>
  <para>
    The <literal>rel="capabilities"</literal> link obtained from the entry point URI (see <xref linkend="chap-REST_API_Guide-Entry_Point"/>) allows information about the supported capabilities of this instance of Red Hat Enterprise Virtualization Manager to be queried. The <literal>capabilities</literal> element contains any number of <literal>version</literal> elements which describe capabilities which are dependent on a compatiblity level. The <literal>version</literal> element may contain the following information:</para>

  <informaltable frame="none">
    <tgroup cols="2">
      <colspec colwidth="2*"/>
      <colspec colwidth="5*"/>
      <tbody>
        <row>
          <entry><literal>major</literal></entry>
          <entry>The major version number</entry>
        </row>
        <row>
          <entry><literal>minor</literal></entry>
          <entry>The minor version number</entry>
        </row>
        <row>
          <entry><literal>current</literal></entry>
          <entry>Whether this is the most recent supported compatibility level</entry>
        </row>
        <row>
          <entry><literal>features</literal></entry>
          <entry>The list of features the version supports. See <xref linkend="sect-REST_API_Guide-Capabilities-Features"/>.</entry>
        </row>
        <row>
          <entry><literal>cpus</literal></entry>
          <entry>List of supported CPU types. See <xref linkend="sect-REST_API_Guide-Capabilities-CPUs"/>.</entry>
        </row>
        <row>
          <entry><literal>power_managers</literal></entry>
          <entry>List of supported fence agents and their configuration options. See <xref linkend="sect-REST_API_Guide-Capabilities-Power_Managers"/>.</entry>
        </row>
        <row>
          <entry><literal>fence_types</literal></entry>
          <entry>Supported fence actions for hosts</entry>
        </row>
        <row>
          <entry><literal>storage_types</literal></entry>
          <entry>Supported storage types for a version</entry>
        </row>
        <row>
          <entry><literal>storage_domain_types</literal></entry>
          <entry>List of all domain types</entry>
        </row>
        <row>
          <entry><literal>vm_types</literal></entry>
          <entry>List of all virtual machine types</entry>
        </row>
        <row>
          <entry><literal>boot_devices</literal></entry>
          <entry>Boot devices for a virtual machine</entry>
        </row>
        <row>
          <entry><literal>display_types</literal></entry>
          <entry>Available display protocols for a virtual machine</entry>
        </row>
 				<row>
          <entry><literal>nic_types</literal></entry>
          <entry>Network interface types for a virtual machine</entry>
        </row>
 				<row>
          <entry><literal>disk_types</literal></entry>
          <entry>List of storage device types</entry>
        </row>
        <row>
          <entry><literal>disk_formats</literal></entry>
          <entry>List of storage device formats</entry>
        </row>
        <row>
          <entry><literal>disk_interfaces</literal></entry>
          <entry>List of interfaces for storage devices</entry>
        </row>
        <row>
          <entry><literal>vm_affinities</literal></entry>
          <entry>Affinities for a host's placement policy</entry>
        </row>
        <row>
          <entry><literal>custom_properties</literal></entry>
          <entry>Environment variables for a virtual machine's custom scripts</entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>
    
	<para>The <literal>capabilities</literal> container also includes capabilities that are not version-specific. This includes:</para>
  <informaltable frame="none">
    <tgroup cols="2">
      <colspec colwidth="2*"/>
      <colspec colwidth="5*"/>
      <tbody>
        <row>
          <entry><literal>permits</literal></entry>
          <entry>A list of allowable actions assignable to roles. See <xref linkend="sect-REST_API_Guide-Capabilities-Permits"/>.</entry>
        </row>
        <row>
          <entry><literal>scheduling_policies</literal></entry>
          <entry>Available virtual machine scheduling modes for hosts in a cluster.</entry>
        </row>
      </tbody>
    </tgroup>
  </informaltable>
  <para>
    For example:
  </para>

  <screen>
GET /rhevm-api/capabilities HTTP/1.1
Accept: application/xml

HTTP/1.1 200 OK
Content-Type: application/xml

&lt;capabilities&gt;
  &lt;version major="2" minor="2"&gt;
    &lt;current/&gt;
    &lt;cpus&gt;
      ...
    &lt;/cpus&gt;
    &lt;power_managers&gt;
      ...
    &lt;/power_managers&gt;
    &lt;fence_types&gt;
      ...
    &lt;/fence_types&gt;
    &lt;storage_types&gt;
      ...
    &lt;/storage_types&gt;
    &lt;storage_domain_types&gt;
      ...
    &lt;/storage_domain_types&gt;
    &lt;vm_types&gt;
      ...
    &lt;/vm_types&gt;
    &lt;boot_devices&gt;
      ...
    &lt;/boot_devices&gt;
    &lt;display_types&gt;
      ...
    &lt;/display_types&gt;
    &lt;nic_types&gt;
      ...
    &lt;/nic_types&gt;
    &lt;disk_types&gt;
      ...
    &lt;/disk_types&gt;
    &lt;disk_formats&gt;
      ...
    &lt;/disk_formats&gt;
    &lt;disk_interfaces&gt;
      ...
    &lt;/disk_interfaces&gt;
    ...
  &lt;/version&gt;
  &lt;version major="3" minor="0"&gt;
    &lt;features&gt;
    	...
    &lt;/features&gt;
    &lt;cpus&gt;
      ...
    &lt;/cpus&gt;
    &lt;power_managers&gt;
      ...
    &lt;/power_managers&gt;
    &lt;fence_types&gt;
      ...
    &lt;/fence_types&gt;
    &lt;storage_types&gt;
      ...
    &lt;/storage_types&gt;
    &lt;storage_domain_types&gt;
      ...
    &lt;/storage_domain_types&gt;
    &lt;vm_types&gt;
      ...
    &lt;/vm_types&gt;
    &lt;boot_devices&gt;
      ...
    &lt;/boot_devices&gt;
    &lt;display_types&gt;
      ...
    &lt;/display_types&gt;
    &lt;nic_types&gt;
      ...
    &lt;/nic_types&gt;
    &lt;disk_types&gt;
      ...
    &lt;/disk_types&gt;
    &lt;disk_formats&gt;
      ...
    &lt;/disk_formats&gt;
    &lt;disk_interfaces&gt;
      ...
    &lt;/disk_interfaces&gt;
    &lt;vm_affinities&gt;
      ...
    &lt;/vm_affinities&gt;
    &lt;custom_properties&gt;
      ...
    &lt;/custom_properties&gt;
    ...
  &lt;/version&gt;
  &lt;permits&gt;
    ...
  &lt;/permits&gt;
  &lt;scheduling_policies&gt;
    ...
  &lt;/scheduling_policies&gt;
&lt;/capabilities&gt;
  </screen>

  <section id="sect-REST_API_Guide-Capabilities-Features">
    <title>Features</title>
    <para>Each <literal>version</literal> contains a list of compatible <literal>features</literal>. These features include:</para>
    <informaltable frame="none">
      <tgroup cols="3">
        <colspec colwidth="4*"/>
        <colspec colwidth="2*"/>
        <colspec colwidth="6*"/>
        <thead>
          <row>
            <entry>Element</entry>
            <entry>Type</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>transparent_hugepages</literal></entry>
            <entry>boolean: true or false</entry>
            <entry>Defines the availablity of Transparent Hugepages for hosts</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>For example:</para>
		<screen>
&lt;capabilities&gt;
  &lt;version major="2" minor="3"&gt;
	  ...
    &lt;features&gt;
      &lt;transparent_hugepages&gt;true&lt;/transparent_hugepages&gt;
    &lt;/features&gt;
    ...
  &lt;/version&gt;
&lt;/capabilities&gt;
    </screen>
	</section>

  <section id="sect-REST_API_Guide-Capabilities-CPUs">
    <title>CPUs</title>

    <para>
      Each cluster is configured with a minimal CPU type which all hosts in that cluster must support. Guests running on hosts within the cluster all run on this CPU type, ensuring that every guest can be live migrated to any host within the cluster.
    </para>

    <para>
      Red Hat Enterprise Virtualization has a set of supported CPU types to choose from when configuring a cluster. Each CPU has the following properties:

      <informaltable frame="none">
        <tgroup cols="2">
          <colspec colwidth="2*"/>
          <colspec colwidth="5*"/>
          <tbody>
            <row>
              <entry><literal>id</literal></entry>
              <entry>An opaque identifier for the CPU model</entry>
            </row>
            <row>
              <entry><literal>level</literal></entry>
              <entry>An indication as to the relative priority/preference for the CPUs in the list. Higher is better</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      For example:
    </para>

    <screen>
&lt;capabilities&gt;
  &lt;cpus&gt;
    &lt;cpu id="Intel Xeon w/o XD/NX"&gt;
      &lt;level&gt;2&lt;/level&gt;
    &lt;/cpu&gt;
    &lt;cpu id="Intel Xeon"&gt;
      &lt;level&gt;3&lt;/level&gt;
    &lt;/cpu&gt;
    ...
  &lt;/cpus&gt;
  ...
&lt;/capabilities&gt;
    </screen>

  </section>

  <section id="sect-REST_API_Guide-Capabilities-Power_Managers">
    <title>Power Managers</title>
    <para>Red Hat Enterprise Virtualization platform provides a list of supported power managers for host fencing configuration. Each power manager contains the following properties:</para>
    <informaltable frame="none">
      <tgroup cols="2">
        <colspec colwidth="2*"/>
        <colspec colwidth="5*"/>
        <tbody>
          <row>
            <entry><literal>type</literal></entry>
            <entry>The supported fencing device type</entry>
          </row>
          <row>
            <entry><literal>options</literal></entry>
            <entry>A list of options available to the supported fencing device. Options include a <literal>name</literal> and a value <literal>type</literal>.</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>For example:</para>
    <screen>
&lt;capabilities&gt;
    &lt;version major="2" minor="2"&gt;
    ...
      &lt;power_managers&gt;
        &lt;power_management type="alom"&gt;
          &lt;options&gt;
            &lt;option type="bool" name="secure"/&gt;
            &lt;option type="int" name="port"/&gt;
          &lt;/options&gt;
        &lt;/power_management&gt;
        &lt;power_management type="apc"&gt;
          &lt;options&gt;
            &lt;option type="bool" name="secure"/&gt;
            &lt;option type="int" name="port"/&gt;
            &lt;option type="int" name="slot"/&gt;
          &lt;/options&gt;
        &lt;/power_management&gt;
        &lt;power_management type="bladecenter"&gt;
          &lt;options&gt;
            &lt;option type="bool" name="secure"/&gt;
            &lt;option type="int" name="port"/&gt;
            &lt;option type="int" name="slot"/&gt;
          &lt;/options&gt;
        &lt;/power_management&gt;
        ...
      &lt;/power_managers&gt;
    ...
  &lt;/version&gt;
&lt;/capabilities&gt;
    </screen>
    <para>Each host can define a power management configuration using one of the listed fencing devices. See <xref linkend="sect-REST_API_Guide-Hosts-Power_Management"/>.</para>
  </section>
	
  <section id="sect-REST_API_Guide-Capabilities-Permits">
    <title>Permits</title>
    <para>Permits are allowable actions a user assigns to a role. Each <literal>permit</literal> contains:</para>
	 <informaltable frame="none">
      <tgroup cols="3">
        <colspec colwidth="2*"/>
        <colspec colwidth="4*"/>
        <colspec colwidth="6*"/>
        <thead>
          <row>
            <entry>Element</entry>
            <entry>Type</entry>
            <entry>Description</entry>
          </row>
        </thead>
        <tbody>
          <row>
            <entry><literal>id=</literal></entry>
            <entry>integer</entry>
            <entry>The opaque identifier for a permit</entry>
          </row>
          <row>
            <entry><literal>name</literal></entry>
            <entry>string</entry>
            <entry>The name of the permit</entry>
          </row>
          <row>
            <entry><literal>administrative</literal></entry>
            <entry>boolean: true or false</entry>
            <entry>The permit is assigned to only administrative roles</entry>
          </row>
        </tbody>
      </tgroup>
    </informaltable>
    <para>For example:</para>
		<screen>
&lt;capabilities&gt;
  &lt;version major="2" minor="2"&gt;
	  ...
  &lt;/version&gt;
  &lt;version major="2" minor="3"&gt;
	  ...
  &lt;/version&gt;
  &lt;permits&gt;
	  &lt;permit id="1"&gt;
      &lt;name&gt;CREATE_VM&lt;/name&gt;
      &lt;administrative&gt;false&lt;/administrative&gt;
  	&lt;/permit&gt;
    &lt;permit id="2"&gt;
      &lt;name&gt;DELETE_VM&lt;/name&gt;
      &lt;administrative&gt;false&lt;/administrative&gt;
    &lt;/permit&gt;
    ...
  &lt;/permits&gt;
  
&lt;/capabilities&gt;
    </screen>
	</section>
</chapter>
